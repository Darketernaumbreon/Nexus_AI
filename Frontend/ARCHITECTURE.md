# NEXUS AI - Project Architecture & Configuration

## Overview

**NEXUS AI** is a comprehensive road network risk assessment and weather simulation platform built with **Next.js 16**, **TypeScript**, and **TailwindCSS**.

This document clarifies the relationship between the original design (Vite/React) and the actual implementation (Next.js).

---

## Design vs Implementation

### Original Design Specification
The **NEXUS_AI_COMPREHENSIVE_DESIGN.md** describes a Vite-based React application with the following structure:

```
src/
├── main.tsx            # Vite entry point
├── vite-env.d.ts       # Vite type definitions
├── App.tsx             # Root component
├── components/
├── features/
├── hooks/
├── lib/
└── styles/
```

### Actual Implementation
This project uses **Next.js 16** with the App Router, which provides better production features:

```
Frontend/
├── app/               # Next.js App Router (replaces main.tsx → App.tsx)
├── next-env.d.ts      # Next.js type definitions (instead of vite-env.d.ts)
├── next.config.mjs    # Next.js configuration
├── components/
├── features/
├── hooks/
├── lib/
└── styles/
```

---

## Key Configuration Files

### 1. **next.config.mjs** - Next.js Configuration
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {};
export default nextConfig;
```
- Configures Next.js build and runtime behavior
- Enables experimental features
- Sets up custom webpack/turbopack configurations
- No equivalent in Vite projects

### 2. **tsconfig.json** - TypeScript Configuration
```json
{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "target": "ES6",
    "paths": {
      "@/*": ["./*"]
    },
    "plugins": [{"name": "next"}]
  }
}
```
**Key Features:**
- `@/*` alias for absolute imports (Next.js plugin)
- ES6 target with DOM types
- Plugin for Next.js integration
- **Same between Vite and Next.js**, with Next.js plugin added

### 3. **tailwind.config.js** - TailwindCSS Configuration
```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./features/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: { /* custom theme */ },
  plugins: [require("tailwindcss-animate")],
};
```
**What it does:**
- Defines content paths for Tailwind to scan
- Extends default theme with custom colors and animations
- Adds animation plugin
- Works identically in both Vite and Next.js

### 4. **postcss.config.mjs** - PostCSS Configuration
```javascript
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
};
export default config;
```
**Purpose:**
- Processes CSS through Tailwind
- Generates utility classes
- Handles CSS transformations
- **Used in both Vite and Next.js**

### 5. **components.json** - Shadcn/UI Configuration
```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "alias": {
    "@/components": "./components"
  }
}
```
**Usage:**
- Configures shadcn/ui CLI for component generation
- Specifies React Server Components support
- Defines alias for component imports
- CLI command: `npx shadcn-ui@latest add [component]`

### 6. **.env.local** - Environment Variables
**Format:** `NEXT_PUBLIC_*` for browser-accessible variables

**Sections:**
- API Configuration (base URL, timeouts, keys)
- Authentication (provider, session timeout)
- Feature Flags (enable/disable features)
- UI Configuration (theme, map settings)
- Logging & Debugging (levels, verbose mode)
- Data & Caching (durations, storage)
- Monitoring (analytics, error tracking)
- Development (port, error details)

**Example:**
```bash
NEXT_PUBLIC_API_BASE_URL=http://localhost:3001
NEXT_PUBLIC_THEME=light
NEXT_PUBLIC_WEATHER_POLLING_INTERVAL=30000
```

---

## Comparison Matrix

| Aspect | Design (Vite) | Implementation (Next.js) | Notes |
|--------|---------------|--------------------------|-------|
| **Build Tool** | Vite | Next.js | Next.js has integrated build optimization |
| **Routing** | React Router | Next.js App Router | File-based routing in `/app` folder |
| **Entry Point** | `src/main.tsx` | `app/layout.tsx` + `app/page.tsx` | No manual entry file needed |
| **Type Defs** | `src/vite-env.d.ts` | `next-env.d.ts` | Auto-generated by build tools |
| **Config** | `vite.config.ts` | `next.config.mjs` | Different configuration approach |
| **Image Optimization** | Manual | Built-in Next.js Image | Automatic performance optimization |
| **API Routes** | External backend | `/app/api/` available | Optional API routes in Next.js |
| **Static Generation** | Manual | ISR & SSG built-in | Better SEO and performance |

---

## File-to-Purpose Mapping

### Root Configuration Files

```
tailwind.config.js       → Define custom CSS classes & animations
postcss.config.mjs       → Process CSS through Tailwind
components.json          → Shadcn/ui component configuration
tsconfig.json            → TypeScript compiler options
next.config.mjs          → Next.js build & runtime configuration
.env.local               → Local environment variables (not committed)
.gitignore               → Files to exclude from Git
package.json             → Dependencies & scripts
```

### Type Definition Files

```
next-env.d.ts            → Auto-generated Next.js types (do not edit)
tsconfig.json            → TypeScript configuration
app/**/*.tsx             → Component type definitions
features/**/types.ts     → Feature-specific types
lib/**/*.ts              → Utility function types
```

### Entry Points (vs Vite/React)

| Concept | Vite/React | Next.js |
|---------|-----------|---------|
| Application bootstrap | `src/main.tsx` imports `App.tsx` | `app/layout.tsx` is root layout |
| Home page | `App.tsx` component | `app/page.tsx` file |
| Login page | `<Route path="/login">` | `app/login/page.tsx` file |
| Network feature | `<Route path="/network">` | `app/network/page.tsx` file |
| Database routes | Not built-in | `app/api/` endpoints |

---

## Styling Architecture

### Global Styles

**`styles/globals.css`** - Tailwind directives
```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

**`styles/animations.css`** - Custom animations
```css
@keyframes fadeIn { /* ... */ }
.animate-fade-in { animation: fadeIn 0.3s ease-in; }
```

### Component Styles

**Tailwind + shadcn/ui approach:**
```tsx
export function Button({ variant, size, ...props }: ButtonProps) {
  return (
    <button 
      className={cn(
        "inline-flex items-center justify-center rounded-md font-medium",
        variant === "outline" && "border bg-white",
      )}
      {...props}
    />
  );
}
```

No CSS modules or styled-components - everything is Tailwind classes.

---

## Environment Variables

### Development (`.env.local`)
```bash
# Local development backend
NEXT_PUBLIC_API_BASE_URL=http://localhost:3001

# Feature flags
NEXT_PUBLIC_FEATURE_NETWORK=true
NEXT_PUBLIC_FEATURE_WEATHER=true
NEXT_PUBLIC_FEATURE_RISK=true
```

### Build-time
```bash
# .env.production
NEXT_PUBLIC_API_BASE_URL=https://api.nexus-ai.com
```

### Deployment
```bash
# Cloud provider environment variables
NEXT_PUBLIC_API_BASE_URL=[set by deployment]
DATABASE_URL=[set by deployment]
```

---

## Module Resolution

### Path Aliases
Configured in `tsconfig.json`:
```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"]
    }
  }
}
```

### Usage
```typescript
// Instead of:
import { Button } from '../../components/ui/button';

// Use:
import { Button } from '@/components/ui/button';
```

### Component Auto-imports
Shadcn/ui components support auto-imports when using compatible IDEs/editors.

---

## Type Safety Strategy

### Global Types
```typescript
// types/index.ts - Shared types
export type RiskLevel = 'low' | 'medium' | 'high' | 'critical';
export interface RiskPoint { /* ... */ }
```

### Feature Types
```typescript
// features/risk/types.ts - Feature-scoped types
export interface RiskSimulationConfig { /* ... */ }
```

### Component Props
```typescript
// features/risk/components/SkeletonLoader.tsx
export interface SkeletonLoaderProps {
  type?: 'result-card' | 'history-list' | 'heatmap';
  count?: number;
}
```

---

## Build & Deployment

### Development Build
```bash
npm run dev
# Starts at http://localhost:3000
# Hot reload enabled
# Source maps generated
```

### Production Build
```bash
npm run build
# Optimizations:
# - Tree shaking (unused code removed)
# - CSS minification (Tailwind)
# - JavaScript minification
# - Static generation for pages
# - Code splitting by route

npm start
# Serves .next/ directory
# Production-optimized
```

### Build Output Structure
```
.next/
├── static/             # Static assets (JS, CSS)
├── server/             # Server-side code
├── cache/              # Build cache
└── ...
```

---

## Comparison: Design Document vs Implementation

### Feature: Network Module

**Design Mentions:**
- "Use PostGIS API for route fetching"
- "Implement fallback to cached routes"
- "Polyline encoding/decoding"

**Implementation Provides:**
- `features/network/api.ts` - All API functions including fallback
- `features/network/hooks/useRoadNetwork.ts` - React hook for data
- `components/PolylineDecoder.tsx` - Polyline visualization
- `features/network/components/OfflineRouteBanner.tsx` - Fallback indicator

**No Changes Needed** - Design requirements are fully implemented.

### Feature: Weather Simulation

**Design Mentions:**
- "Real-time weather grid visualization"
- "Alert system for extreme weather"
- "WebSocket for live updates"

**Implementation Provides:**
- `features/weather/api.ts` - Weather APIs with WebSocket
- `features/weather/hooks/useWeatherPolling.ts` - Polling with backoff
- `features/weather/components/` - Grid, alerts, heatmap, charts

**Features Enhanced:**
- Forecast data with confidence levels
- Rainfall intensity heatmap
- Multi-metric charts (temperature, humidity, precipitation)

### Feature: Risk Analysis

**Design Mentions:**
- "Simulation execution with scenarios"
- "Results visualization and history"
- "Status tracking"

**Implementation Provides:**
- `features/risk/api.ts` - Full simulation APIs
- `features/risk/constants.ts` - Risk levels, colors, scenarios
- `features/risk/hooks/` - Status polling + full result polling
- `features/risk/components/` - History, skeleton loaders

**Extra Capabilities:**
- Automatic fallback to cached results
- Exponential backoff on failures
- Comprehensive error handling

---

## Migration Path (if needed)

If switching from Next.js back to Vite/React:

1. **Create `src/` folder structure**
   ```bash
   mkdir src
   mv app src/pages  # or app.tsx for App Router
   mv components src/
   mv features src/
   ```

2. **Add Vite entry point**
   ```typescript
   // src/main.tsx
   import React from 'react'
   import App from './App'
   
   ReactDOM.createRoot(document.getElementById('root')).render(
     <React.StrictMode>
       <App />
     </React.StrictMode>
   )
   ```

3. **Create App component**
   ```typescript
   // src/App.tsx
   import { BrowserRouter, Routes, Route } from 'react-router-dom'
   // ... implement routing
   ```

4. **Replace configurations**
   - Remove `next.config.mjs`
   - Add `vite.config.ts`
   - Keep `tsconfig.json` and `tailwind.config.js`

**Note:** This would not be necessary as Next.js provides all functionality and more.

---

## Performance Characteristics

### Next.js Advantages
- ✅ Static Site Generation (SSG)
- ✅ Incremental Static Regeneration (ISR)
- ✅ Image optimization built-in
- ✅ Automatic code splitting
- ✅ API routes integrated
- ✅ Production-ready caching headers

### Vite Advantages (not needed here)
- ✅ Faster development server startup
- ✅ Simpler configuration
- ✅ Better for simple SPA projects

**For NEXUS AI:** Next.js is the better choice due to complexity and production requirements.

---

## Summary

| File | Purpose | Replaces |
|------|---------|----------|
| `next.config.mjs` | Next.js configuration | `vite.config.ts` |
| `tailwind.config.js` | Tailwind theme & plugins | Same in both |
| `postcss.config.mjs` | CSS processing | Same in both |
| `components.json` | Shadcn/ui setup | N/A (UI only) |
| `.env.local` | Environment variables | `.env` or `.env.development` |
| `tsconfig.json` | TypeScript settings | Same with Next.js plugin |
| `app/` folder | Next.js routing | `src/` with React Router |
| `next-env.d.ts` | Type definitions | `vite-env.d.ts` |

---

**Project Status**: ✅ Complete and building successfully  
**Next.js Version**: 16.0.10  
**Date**: January 28, 2026
